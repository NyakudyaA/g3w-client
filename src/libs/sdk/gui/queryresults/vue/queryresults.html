<div id="search-results" class="queryresults-container">
  <h3>Risultati {{state.querytitle | lowercase}}</h3>
  <div v-show="state.loading" class="bar-loader"></div>
  <ul v-if="hasResults()" class="queryresults" id="queryresults">
    <li v-if="layerHasFeatures(layer)" v-for="layer in state.layers">
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">{{ layer.title }} ({{layer.features.length}})</h3>
          <div class="box-tools pull-right">
            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          </div>
        </div>
        <div class="box-body">
          <template v-for="feature in layer.features">
            <table class="table table-striped">
              <thead>
              <tr>
                <th v-for="attribute in attributesSubset(layer.attributes)">{{attribute.label}}</th>
              </tr>
              </thead>
              <tbody>
                <tr class="attributes-preview" @click="toggleFeatureBox(layer,feature)">
                  <td v-for="attribute in attributesSubset(layer.attributes)">
                    <span>{{feature.attributes[attribute.name]}}</span>
                  </td>
                  <td><span class="glyphicon glyphicon-option-horizontal link morelink"></span></td>
                </tr>
                <tr v-show="collapseFeatureBox(layer,feature)" class="queryresults-featurebox">
                  <td :colspan="attributesSubsetLength(layer.attributes)+1">
                    <div class="action-buttons-container">
                      <div v-if="geometryAvailable(feature)" class="action-button hint--top-right" aria-label="Visualizza sulla mappa">
                        <span class="action-button-icon glyphicon glyphicon-map-marker" @click="trigger('gotogeometry',layer,feature)"></span>
                      </div>
                    </div>
                    <table>
                      <tr v-for="attribute in layer.attributes">
                        <td class="attr-label">{{attribute.label}}</td>
                        <td class="attr-value">{{feature.attributes[attribute.name]}}</td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </tbody>
            </table>
            <!--Relazioni-->
            <div class="queryresults-container">
              <ul v-if="feature.attributes.relations" class="queryresults" id="relations">
                <template v-for="relation in feature.attributes.relations">
                  <li>
                    <div class="box box-solid box-default">
                      <div class="box-header with-border">
                        <h3 class="box-title">{{ relation.name }} ({{ relation.elements.length }})</h3>
                        <div class="box-tools pull-right">
                          <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                        </div>
                      </div>
                      <div class="box-body">
                        <template v-for="(index, element) in relation.elements">
                          <table class="table table-striped">
                            <thead>
                            <tr>
                              <th v-for="attribute in relationsAttributesSubset(element)">
                                {{attribute.label}}
                              </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="attributes-preview" @click="toggleFeatureBox(layer, feature, index)">
                              <td v-for="attribute in relationsAttributesSubset(element)">
                                <span>{{attribute.value}}</span>
                              </td>
                              <td>
                                <span class="glyphicon glyphicon-option-horizontal link morelink"></span>
                              </td>
                            </tr>
                            <tr v-show="collapseFeatureBox(layer, feature, index)" class="queryresults-featurebox">
                              <td :colspan="relationsAttributesSubsetLength(element)+1">
                                <table>
                                  <tr v-for="attribute in relationsAttributes(element)">
                                    <td class="attr-label">{{attribute.label}}</td>
                                    <td class="attr-value">{{attribute.value}}</td>
                                  </tr>
                                </table>
                              </td>
                            </tr>
                            </tbody>
                          </table>
                        </template>
                      </div>
                    </div>
                  </li>
                </template>
              </ul>
            </div>
            <!--Fine Relazioni-->
          </template>
        </div>
      </div>
    </li>
  </ul>
  <span v-if="!hasResults()">Nessun risultato</span>
</div>

