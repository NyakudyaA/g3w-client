<div>
  <validator name="validation">
    <form novalidate class="form-horizontal g3w-form" :class="[$validation[relfield.name].invalid ? 'has-error': '']">
      <template v-for="field in state.fields">
        <div v-if="isVisible(field)" class="form-group has-feedback" :class="[$validation[field.name].invalid ? 'has-error': '']">
          <label :for="field.name" class="col-sm-4 control-label">{{ field.label }}<span v-if="field.validate && field.validate.required">*</span></label>
          <div class="col-sm-8">
            <input v-if="isSimple(field)" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">
            <select v-if="isSelect(field)" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">
              <option v-for="value in field.input.options.values" value="{{ value.key }}">{{ value.value }}</option>
            </select>
            <div v-if="isBoolean(field)" class="checkbox">
              <label><input type="checkbox" v-model="field.value" :id="field.name" v-disabled="!isEditable(field)"></label>
            </div>
            <div v-if="isLayerPicker(field)">
              <input class="form-control" @click="pickLayer(field)" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" onfocus="blur()" data-toggle="tooltip" title="Ottieni il dato da un elemento del layer '{{ layerPickerPlaceHolder(field) }}'" v-model="field.value" :id="field.name" :placeholder="'['+layerPickerPlaceHolder(field)+']'">
              <i class="glyphicon glyphicon-screenshot form-control-feedback"></i>
            </div>  
          </div>
        </div>
      </template>
      <div v-for="relation in state.relations">
        <div v-if="showRelation(relation)" transition="expand">
          <div class="g3w-relationname">{{ relation.name | startcase }}</div>
          <template v-for="relfield in relation.fields">
            <div v-if="isVisible(relfield)" class="form-group has-feedback" :class="[$validation[relfield.name].invalid ? 'has-error': '']">
              <label :for="relfield.name" class="col-sm-4 control-label">{{relfield.label}}<span v-if="relfield.validate && relfield.validate.required">*</span></label>
              <div class="col-sm-8">
                <input v-if="isSimple(relfield)" :field="relfield.name" v-validate="relfield.validate" v-disabled="!isEditable(relfield)" class="form-control" v-model="relfield.value" :id="relfield.name" :placeholder="relfield.input.label">
                <select v-if="isSelect(relfield)" :field="relfield.name" v-validate="relfield.validate" v-disabled="!isEditable(relfield)" class="form-control" v-model="relfield.value" :id="relfield.name" :placeholder="relfield.input.label">
                  <option v-for="relvalue in relfield.input.options.values" value="{{ relvalue.key }}">{{ relvalue.value }}</option>
                </select>
                <input v-if="isBoolean(relfield)" type="checkbox" v-model="relfield.value" :id="relfield.name" v-disabled="!isEditable(relfield)">
                <div v-if="isLayerPicker(relfield)">
                  <input class="form-control" @click="pickLayer(relfield)" :field="relfield.name" v-validate="relfield.validate" v-disabled="!isEditable(relfield)" onfocus="blur()" style="cursor:pointer" data-toggle="tooltip" title="Ottieni il dato da un elemento del layer '{{ layerPickerPlaceHolder(relfield) }}'" v-model="relfield.value" :id="relfield.name" :placeholder="'['+layerPickerPlaceHolder(relfield)+']'">
                  <i class="glyphicon glyphicon-screenshot form-control-feedback"></i>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-4 col-sm-8">
          <div v-if="hasFieldsRequired" style="margin-bottom:10px">
            <span>* Campi richiesti</span>
          </div>
          <span v-for="button in buttons">
            <button class="btn " :class="[button.class]" @click.stop.prevent="exec(button.cbk)" v-disabled="!btnEnabled(button)">{{ button.title }}</button>
          </span>
        </div>
      </div>
    </form>
  </validator>
</div>
